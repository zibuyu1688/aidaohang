<!DOCTYPE html>
<html>
<head>
    <title>è°ƒè¯•æµ‹è¯•</title>
    <style>
        body { font-family: monospace; padding: 20px; background: #f5f5f5; }
        .test-box { background: white; padding: 15px; margin: 10px 0; border-radius: 4px; border-left: 4px solid #007AFF; }
        .pass { border-left-color: #34C759; }
        .fail { border-left-color: #FF3B30; }
        .warn { border-left-color: #FF9500; }
        code { background: #f0f0f0; padding: 2px 6px; border-radius: 3px; }
        .result { padding: 10px; margin: 5px 0; background: #f9f9f9; border: 1px solid #ddd; border-radius: 3px; }
        button { padding: 8px 16px; margin: 5px; cursor: pointer; background: #007AFF; color: white; border: none; border-radius: 4px; }
    </style>
</head>
<body>
    <h1>ğŸ” çˆ±æœ AISearch åº”ç”¨è°ƒè¯•æµ‹è¯•</h1>
    
    <div class="test-box warn">
        <strong>åŠ è½½çŠ¶æ€:</strong> æ£€æŸ¥è„šæœ¬åŠ è½½...
        <div id="status"></div>
    </div>
    
    <button onclick="testLocalSearch()">âœ“ æµ‹è¯•1: æœ¬åœ°æœç´¢</button>
    <button onclick="testCacheSystem()">âœ“ æµ‹è¯•2: ç¼“å­˜ç³»ç»Ÿ</button>
    <button onclick="testConfigLoaded()">âœ“ æµ‹è¯•3: é…ç½®æ£€æŸ¥</button>
    <button onclick="testWebsitesDB()">âœ“ æµ‹è¯•4: ç½‘ç«™åº“æ£€æŸ¥</button>
    <button onclick="testFunctions()">âœ“ æµ‹è¯•5: å‡½æ•°æ£€æŸ¥</button>
    
    <div id="results"></div>
    
    <script src="config.js"></script>
    <script src="websites.js"></script>
    <script src="app.js"></script>
    
    <script>
        function addResult(title, content, type = 'pass') {
            const div = document.createElement('div');
            div.className = `test-box ${type}`;
            div.innerHTML = `<strong>${title}:</strong><div class="result">${content}</div>`;
            document.getElementById('results').appendChild(div);
        }
        
        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('status').innerHTML = 'âœ“ æ‰€æœ‰è„šæœ¬å·²åŠ è½½';
        });
        
        function testLocalSearch() {
            console.clear();
            console.log('=== æµ‹è¯•æœ¬åœ°æœç´¢ ===');
            
            try {
                // æµ‹è¯•æœç´¢"å»æ°´å°"
                const result = searchLocalDatabase('å»æ°´å°');
                addResult('æœ¬åœ°æœç´¢ "å»æ°´å°"', 
                    `æ‰¾åˆ° <strong>${result.length}</strong> ä¸ªç»“æœ<br>` +
                    `æ ·æœ¬: ${result.slice(0, 3).map(r => r.name).join(', ')}`);
                console.log('âœ“ æœ¬åœ°æœç´¢æˆåŠŸ:', result.length, 'ä¸ªç»“æœ');
            } catch (e) {
                addResult('æœ¬åœ°æœç´¢é”™è¯¯', `âŒ ${e.message}`, 'fail');
                console.error('âŒ æœ¬åœ°æœç´¢å¤±è´¥:', e);
            }
        }
        
        function testCacheSystem() {
            try {
                const testData = [{name: 'æµ‹è¯•', url: 'https://test.com'}];
                setCache('æµ‹è¯•æŸ¥è¯¢', testData);
                const cached = getCache('æµ‹è¯•æŸ¥è¯¢');
                
                if (cached && cached.length === 1) {
                    addResult('ç¼“å­˜ç³»ç»Ÿ', 'âœ“ ä¿å­˜å’Œè¯»å–æˆåŠŸ');
                    console.log('âœ“ ç¼“å­˜ç³»ç»Ÿå·¥ä½œæ­£å¸¸');
                } else {
                    addResult('ç¼“å­˜ç³»ç»Ÿ', 'âŒ ç¼“å­˜æ•°æ®ä¸åŒ¹é…', 'fail');
                }
            } catch (e) {
                addResult('ç¼“å­˜ç³»ç»Ÿé”™è¯¯', `âŒ ${e.message}`, 'fail');
            }
        }
        
        function testConfigLoaded() {
            try {
                const hasConfig = typeof CONFIG !== 'undefined';
                const hasApiKey = CONFIG && CONFIG.DEEPSEEK_API_KEY;
                const hasUrl = CONFIG && CONFIG.DEEPSEEK_API_URL;
                
                if (hasConfig && hasApiKey && hasUrl) {
                    addResult('é…ç½®æ£€æŸ¥', 
                        `âœ“ CONFIGå·²åŠ è½½<br>` +
                        `âœ“ API Keyé•¿åº¦: ${hasApiKey.length}<br>` +
                        `âœ“ API URL: ${CONFIG.DEEPSEEK_API_URL}`);
                    console.log('âœ“ é…ç½®åŠ è½½å®Œæˆ');
                } else {
                    addResult('é…ç½®æ£€æŸ¥', `âŒ é…ç½®ç¼ºå¤±`, 'fail');
                }
            } catch (e) {
                addResult('é…ç½®æ£€æŸ¥é”™è¯¯', `âŒ ${e.message}`, 'fail');
            }
        }
        
        function testWebsitesDB() {
            try {
                const dbExists = typeof websitesDatabase !== 'undefined';
                const dbLength = websitesDatabase ? websitesDatabase.length : 0;
                const hotExists = typeof hotWebsites !== 'undefined';
                const hotLength = hotWebsites ? hotWebsites.length : 0;
                
                if (dbExists && hotExists) {
                    addResult('ç½‘ç«™åº“æ£€æŸ¥', 
                        `âœ“ ç½‘ç«™åº“åŠ è½½å®Œæˆ<br>` +
                        `æ€»ç½‘ç«™æ•°: <strong>${dbLength}</strong><br>` +
                        `çƒ­é—¨ç½‘ç«™æ•°: <strong>${hotLength}</strong><br>` +
                        `æ ·æœ¬ç½‘ç«™: ${websitesDatabase[0]?.name}`);
                    console.log('âœ“ ç½‘ç«™åº“åŠ è½½å®Œæˆ, å…±', dbLength, 'ä¸ªç½‘ç«™');
                } else {
                    addResult('ç½‘ç«™åº“æ£€æŸ¥', `âŒ ç½‘ç«™åº“ç¼ºå¤±`, 'fail');
                }
            } catch (e) {
                addResult('ç½‘ç«™åº“æ£€æŸ¥é”™è¯¯', `âŒ ${e.message}`, 'fail');
            }
        }
        
        function testFunctions() {
            try {
                const functions = [
                    'getCache', 'setCache', 'getApiKey',
                    'searchLocalDatabase', 'analyzeIntent', 'matchLocalDatabase',
                    'getAIRecommendations', 'intelligentSearch', 'displayResults', 'handleSearch'
                ];
                
                const missing = functions.filter(f => typeof window[f] !== 'function');
                const available = functions.filter(f => typeof window[f] === 'function');
                
                let html = `âœ“ å¯ç”¨å‡½æ•°: ${available.length}/${functions.length}<br>`;
                if (missing.length > 0) {
                    html += `âŒ ç¼ºå¤±å‡½æ•°: ${missing.join(', ')}`;
                    addResult('å‡½æ•°æ£€æŸ¥', html, 'warn');
                } else {
                    html += 'âœ“ æ‰€æœ‰å¿…éœ€å‡½æ•°éƒ½å·²å®šä¹‰';
                    addResult('å‡½æ•°æ£€æŸ¥', html);
                }
                
                console.log('âœ“ å‡½æ•°æ£€æŸ¥å®Œæˆ, ç¼ºå¤±:', missing.length);
            } catch (e) {
                addResult('å‡½æ•°æ£€æŸ¥é”™è¯¯', `âŒ ${e.message}`, 'fail');
            }
        }
    </script>
</body>
</html>
