<!DOCTYPE html>
<html>
<head>
    <title>调试测试</title>
    <style>
        body { font-family: monospace; padding: 20px; background: #f5f5f5; }
        .test-box { background: white; padding: 15px; margin: 10px 0; border-radius: 4px; border-left: 4px solid #007AFF; }
        .pass { border-left-color: #34C759; }
        .fail { border-left-color: #FF3B30; }
        .warn { border-left-color: #FF9500; }
        code { background: #f0f0f0; padding: 2px 6px; border-radius: 3px; }
        .result { padding: 10px; margin: 5px 0; background: #f9f9f9; border: 1px solid #ddd; border-radius: 3px; }
        button { padding: 8px 16px; margin: 5px; cursor: pointer; background: #007AFF; color: white; border: none; border-radius: 4px; }
    </style>
</head>
<body>
    <h1>🔍 爱搜 AISearch 应用调试测试</h1>
    
    <div class="test-box warn">
        <strong>加载状态:</strong> 检查脚本加载...
        <div id="status"></div>
    </div>
    
    <button onclick="testLocalSearch()">✓ 测试1: 本地搜索</button>
    <button onclick="testCacheSystem()">✓ 测试2: 缓存系统</button>
    <button onclick="testConfigLoaded()">✓ 测试3: 配置检查</button>
    <button onclick="testWebsitesDB()">✓ 测试4: 网站库检查</button>
    <button onclick="testFunctions()">✓ 测试5: 函数检查</button>
    
    <div id="results"></div>
    
    <script src="config.js"></script>
    <script src="websites.js"></script>
    <script src="app.js"></script>
    
    <script>
        function addResult(title, content, type = 'pass') {
            const div = document.createElement('div');
            div.className = `test-box ${type}`;
            div.innerHTML = `<strong>${title}:</strong><div class="result">${content}</div>`;
            document.getElementById('results').appendChild(div);
        }
        
        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('status').innerHTML = '✓ 所有脚本已加载';
        });
        
        function testLocalSearch() {
            console.clear();
            console.log('=== 测试本地搜索 ===');
            
            try {
                // 测试搜索"去水印"
                const result = searchLocalDatabase('去水印');
                addResult('本地搜索 "去水印"', 
                    `找到 <strong>${result.length}</strong> 个结果<br>` +
                    `样本: ${result.slice(0, 3).map(r => r.name).join(', ')}`);
                console.log('✓ 本地搜索成功:', result.length, '个结果');
            } catch (e) {
                addResult('本地搜索错误', `❌ ${e.message}`, 'fail');
                console.error('❌ 本地搜索失败:', e);
            }
        }
        
        function testCacheSystem() {
            try {
                const testData = [{name: '测试', url: 'https://test.com'}];
                setCache('测试查询', testData);
                const cached = getCache('测试查询');
                
                if (cached && cached.length === 1) {
                    addResult('缓存系统', '✓ 保存和读取成功');
                    console.log('✓ 缓存系统工作正常');
                } else {
                    addResult('缓存系统', '❌ 缓存数据不匹配', 'fail');
                }
            } catch (e) {
                addResult('缓存系统错误', `❌ ${e.message}`, 'fail');
            }
        }
        
        function testConfigLoaded() {
            try {
                const hasConfig = typeof CONFIG !== 'undefined';
                const hasApiKey = CONFIG && CONFIG.DEEPSEEK_API_KEY;
                const hasUrl = CONFIG && CONFIG.DEEPSEEK_API_URL;
                
                if (hasConfig && hasApiKey && hasUrl) {
                    addResult('配置检查', 
                        `✓ CONFIG已加载<br>` +
                        `✓ API Key长度: ${hasApiKey.length}<br>` +
                        `✓ API URL: ${CONFIG.DEEPSEEK_API_URL}`);
                    console.log('✓ 配置加载完成');
                } else {
                    addResult('配置检查', `❌ 配置缺失`, 'fail');
                }
            } catch (e) {
                addResult('配置检查错误', `❌ ${e.message}`, 'fail');
            }
        }
        
        function testWebsitesDB() {
            try {
                const dbExists = typeof websitesDatabase !== 'undefined';
                const dbLength = websitesDatabase ? websitesDatabase.length : 0;
                const hotExists = typeof hotWebsites !== 'undefined';
                const hotLength = hotWebsites ? hotWebsites.length : 0;
                
                if (dbExists && hotExists) {
                    addResult('网站库检查', 
                        `✓ 网站库加载完成<br>` +
                        `总网站数: <strong>${dbLength}</strong><br>` +
                        `热门网站数: <strong>${hotLength}</strong><br>` +
                        `样本网站: ${websitesDatabase[0]?.name}`);
                    console.log('✓ 网站库加载完成, 共', dbLength, '个网站');
                } else {
                    addResult('网站库检查', `❌ 网站库缺失`, 'fail');
                }
            } catch (e) {
                addResult('网站库检查错误', `❌ ${e.message}`, 'fail');
            }
        }
        
        function testFunctions() {
            try {
                const functions = [
                    'getCache', 'setCache', 'getApiKey',
                    'searchLocalDatabase', 'analyzeIntent', 'matchLocalDatabase',
                    'getAIRecommendations', 'intelligentSearch', 'displayResults', 'handleSearch'
                ];
                
                const missing = functions.filter(f => typeof window[f] !== 'function');
                const available = functions.filter(f => typeof window[f] === 'function');
                
                let html = `✓ 可用函数: ${available.length}/${functions.length}<br>`;
                if (missing.length > 0) {
                    html += `❌ 缺失函数: ${missing.join(', ')}`;
                    addResult('函数检查', html, 'warn');
                } else {
                    html += '✓ 所有必需函数都已定义';
                    addResult('函数检查', html);
                }
                
                console.log('✓ 函数检查完成, 缺失:', missing.length);
            } catch (e) {
                addResult('函数检查错误', `❌ ${e.message}`, 'fail');
            }
        }
    </script>
</body>
</html>
